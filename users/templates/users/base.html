{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Care Connect - {% block title %}Mental Health Support{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    {% block extra_css %}{% endblock %}
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§ </text></svg>">
    <style>
        .chart-container {
            position: relative;
            height: 200px;
            width: 100%;
        }
        @media (max-width: 640px) {
            .chart-container {
                height: 180px;
            }
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin: 0.25rem 0;
            border-radius: 0.5rem;
            color: #e5e7eb;
        }
        .sidebar-link:hover {
            background-color: #1f2937;
            color: #ffffff;
        }
        .sidebar-icon {
            width: 1.5rem;
            margin-right: 0.75rem;
            text-align: center;
        }
        
        /* Custom alert styles */
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid;
        }
        
        .alert-success {
            background-color: #f0f9ff;
            border-color: #10b981;
            color: #065f46;
        }
        
        .alert-warning {
            background-color: #fffbeb;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        .alert-error {
            background-color: #fef2f2;
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .alert-info {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }
        
        /* Accessibility improvements */
        .focus\:ring-2:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px #3b82f6;
        }
        
        /* Mobile responsive sidebar */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-gray-100" x-data="{ sidebarOpen: false }" x-init="$watch('sidebarOpen', value => document.body.classList.toggle('overflow-hidden', value))">
    <!-- Mobile menu button -->
    <div class="md:hidden fixed top-4 left-4 z-50">
        <button @click="sidebarOpen = !sidebarOpen" 
                class="bg-gray-900 text-white p-2 rounded-md focus:ring-2 focus:ring-blue-500"
                aria-label="Toggle navigation menu">
            <i class="fas fa-bars" x-show="!sidebarOpen"></i>
            <i class="fas fa-times" x-show="sidebarOpen"></i>
        </button>
    </div>

    <!-- Sidebar overlay for mobile -->
    <div x-show="sidebarOpen" 
         x-transition:enter="transition-opacity ease-linear duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-gray-600 bg-opacity-75 z-40 md:hidden"
         @click="sidebarOpen = false"></div>

    <!-- Sidebar -->
    <div class="flex">
        <div class="sidebar fixed md:static inset-y-0 left-0 z-50 w-64 bg-gray-900 text-white min-h-screen p-5 transform md:transform-none transition-transform duration-300 ease-in-out"
             :class="{ 'translate-x-0': sidebarOpen, '-translate-x-full': !sidebarOpen }"
             x-show="sidebarOpen || window.innerWidth >= 768"
             x-init="$watch('$store.screen.width', value => { if (value >= 768) sidebarOpen = false })">
            <div class="flex items-center mb-8">
                <i class="fas fa-brain text-2xl text-blue-400 mr-3" aria-hidden="true"></i>
                <h2 class="text-2xl font-bold">CareConnect</h2>
            </div>
            <nav aria-label="Main navigation">
                <ul class="space-y-2" role="menubar">
                    <li role="none">
                        <a href="{% url 'users:dashboard' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Go to Dashboard">
                            <i class="fas fa-house sidebar-icon" aria-hidden="true"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'users:mental_health_test' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Take Mental Health Assessment">
                            <i class="fas fa-clipboard-check sidebar-icon" aria-hidden="true"></i>
                            <span>Take Assessment</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'users:test_history' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="View Test History">
                            <i class="fas fa-chart-line sidebar-icon" aria-hidden="true"></i>
                            <span>Test History</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'users:mood_tracking' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Track Your Mood">
                            <i class="fas fa-face-smile sidebar-icon" aria-hidden="true"></i>
                            <span>Mood Tracking</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'users:report' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="View Reports">
                            <i class="fas fa-chart-bar sidebar-icon" aria-hidden="true"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'games:games_list' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Play Wellness Games">
                            <i class="fas fa-puzzle-piece sidebar-icon" aria-hidden="true"></i>
                            <span>Games</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'meditation:meditation_page' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Meditation Sessions">
                            <i class="fas fa-spa sidebar-icon" aria-hidden="true"></i>
                            <span>Meditation</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="{% url 'users:chatbot' %}" 
                           class="sidebar-link focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="AI Support Assistant">
                            <i class="fas fa-robot sidebar-icon" aria-hidden="true"></i>
                            <span>AI Support Assistant</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="https://www.amahahealth.com/therapy-psychiatry/lpexpt/2b3/?utm_term=remarketing_02feb24" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="sidebar-link bg-gray-800 hover:bg-gray-700 focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Find a Therapist (opens in new tab)">
                            <i class="fas fa-stethoscope sidebar-icon" aria-hidden="true"></i>
                            <span>Find a Therapist</span>
                        </a>
                    </li>
                    <li role="none" class="mt-8">
                        <a href="{% url 'users:logout' %}" 
                           class="sidebar-link text-gray-400 hover:text-white focus:ring-2 focus:ring-blue-500" 
                           role="menuitem"
                           aria-label="Logout">
                            <i class="fas fa-right-from-bracket sidebar-icon" aria-hidden="true"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 md:ml-0 p-4 md:p-10">
            <!-- Messages/Alerts -->
            {% if messages %}
                <div class="mb-6" role="alert" aria-live="polite">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} flex items-center">
                            <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'warning' %}exclamation-triangle{% elif message.tags == 'error' %}times-circle{% else %}info-circle{% endif %} mr-3" aria-hidden="true"></i>
                            <span>{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50" role="dialog" aria-labelledby="confirmTitle" aria-describedby="confirmMessage">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 id="confirmTitle" class="text-lg font-semibold text-gray-900">Confirm Action</h3>
            </div>
            <div class="p-6">
                <p id="confirmMessage" class="text-gray-700 mb-6">Are you sure you want to proceed?</p>
                <div class="flex justify-end space-x-3">
                    <button id="confirmCancel" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors focus:ring-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button id="confirmOk" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors focus:ring-2 focus:ring-red-500">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% block extra_js %}{% endblock %}
    
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
        // Confirmation dialog utility
        function showConfirmDialog(title, message, onConfirm, onCancel = null) {
            const modal = document.getElementById('confirmModal');
            const titleEl = document.getElementById('confirmTitle');
            const messageEl = document.getElementById('confirmMessage');
            const confirmBtn = document.getElementById('confirmOk');
            const cancelBtn = document.getElementById('confirmCancel');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Focus management
            confirmBtn.focus();
            
            const handleConfirm = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                if (onConfirm) onConfirm();
                cleanup();
            };
            
            const handleCancel = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                if (onCancel) onCancel();
                cleanup();
            };
            
            const cleanup = () => {
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
                document.removeEventListener('keydown', handleKeydown);
            };
            
            const handleKeydown = (e) => {
                if (e.key === 'Escape') {
                    handleCancel();
                }
            };
            
            confirmBtn.addEventListener('click', handleConfirm);
            cancelBtn.addEventListener('click', handleCancel);
            document.addEventListener('keydown', handleKeydown);
        }
        
        // Auto-hide alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s ease-out';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                }, 5000);
            });
        });
    </script>
</body>
</html>
